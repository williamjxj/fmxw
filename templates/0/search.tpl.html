<div class="row">
  <div class="span12 centered">
    <form class="form-search" action="{$config.search}" method="get" name="sf" id="sf">
      <input type="text" name="q" id="typeahead" class="input-large search-query" style="width:400px; height:35px;" data-provide="typeahead" autocomplete="off"  placeholder="请输入关键词" />
      <input type="hidden" name="fm0" value=""  />
      <button type="submit" class="btn btn-primary" id="ns"> <i class="icon-search icon-white"></i>{$_ts.new_search} </button>
      <img id="waiting" src="images/noimg.gif" width="16" height="16" border="0" />
      <button type="button" class="btn btn-primary" id="os"> <i class="icon-search icon-white"></i>{$_ts.old_search} </button>
    </form>
  </div>
  <br/>
  <div class="span12"> <span class="label label-warning">热门搜索词:</span> <span class="alert"> {foreach $keywords as $rm} <a class="post-tag" href="javascript:;" datasrc="{$rm.0}">{$rm.0}($rm.1)</a>&nbsp;
    {/foreach} </span> </div>
  <br/>
  <div class="span12 centered">
    <ul id="js-news" class="js-hidden">
      {foreach $tickers as $tk}
      <li class="news-item"><a href="javascript:;" datasrc="{$tk.0}">{$tk.0}</a></li>
      {/foreach}
    </ul>
  </div>
</div>
<script type="text/javascript">
$(function() {
	$('#os').click(function(e) {
		e.preventDefault();
		form = document.getElementById('sf');
		form.action = 'f1.php';
		form.method = 'get';
		form.submit();
		return false;
	});
	//热门搜索词：
	$('a.post-tag').click(function(e) {
		e.preventDefault();
		var t = $(e.target);
		$('#typeahead').val(t.attr('datasrc'));
		$('#sf').trigger('submit');
		return false;
	});
	//最新查询：
	$('a', '#js-news').click(function(e) {
		e.preventDefault();
		var t = $(e.target);
		$('#typeahead').val(t.attr('datasrc'));
		$('#sf').trigger('submit');
		return false;
	});
	/*
	$('form#sf').submit(function() {
		var t = $('#typeahead').val();
		if (/^\s*$/.test(t)) {
			$('#sf').attr('placeholder', '请输入关键词。');
			$('#typeahead').focus();
			return false;
		}
		return true;
	});	*/
	var no_typeahead=false, timer;
	$('#typeahead').typeahead({
		source : function(typeahead, query) {
			if(query.length==0) return false;
			// if(no_typeahead) return false;
			clearTimeout(timer);
			timer=setTimeout(function() {
				$.ajax({
					url : 'keys_search.php',
					type : 'GET',
					data : 'q=' + query,
					dataType : 'JSON',
					async : false,
					cache : false,
					beforeSend : function() {
						$('#waiting').attr('src', 'images/spinner.gif');
					},
					success : function(data) {
						// if json is null, means no match, won't do again.
						if(data.length === 0)
							no_typeahead = true;
						typeahead.process(data);
						$('#waiting').attr('src', 'images/noimg.gif'); //http://placehold.it/16x16
					}
				});
			}, 200);
		}
	});
	$('#js-news').ticker();
});
</script>

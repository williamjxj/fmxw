
<!-- saved from url=(0065)http://www.nearby.org.uk/sphinx/search-example7-withcomments.phps -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><script>window["_GOOG_TRANS_EXT_VER"] = "1";</script><style type="text/css">/* Local ID — mndocdiojkckhpnhpeminpalidafeink */
/* Web Store ID — ihmgiclibbndffejedjimfjmfoabpcke */

.TnITTtw-help-selected-wrap {
  border: 1px solid #C7C6C2;
  box-shadow: 0 0 10px rgba(43, 43, 43, 0.325);
  border-radius: 4px;
  width: 231px
}

  .TnITTtw-help-inside-layout {
    height: 133px;
    background: #F5F5F5;
    border-radius: 3px
  }

    .TnITTtw-left-particle {
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;
      box-shadow: inset 0 1px 0 white;
      color: #4E4E4E;
      text-shadow: 0 1px 0 white;
      width: 194px;
      display: inline-block;
      border-right: 1px solid #D9D9D9
    }

      .TnITTtw-content-layout {
        text-align: left;
        margin: 10px 15px
      }

        .TnITTtw-variant-bunch-wrap {

        }

          .TnITTtw-variant-bunch-wrap .inside-layout {

          }

            .TnITTtw-main-variant-wrap {

            }

              .TnITTtw-main-variant {
                font-weight: 700;
                font-size: 15px;
                text-shadow: 0 1px 0 rgba(255, 255, 255, 0.775);
                display: inline-block;
                vertical-align: top;
                color: #2B2B2B
              }

            .TnITTtw-variants-by-pos {
              
            }

              .TnITTtw-TnITTtw-variant-row {
                text-shadow: 0 1px 0 rgba(255, 255, 255, 0.775)
              }

                .TnITTtw-v-pos {
                  font-weight: 700;
                  margin-top: 10px;
                  font-size: 12px;
                  color: #545454
                }

                  .TnITTtw-v-pos:first-child {
                    margin-top: 8px
                  }

                .TnITTtw-v-closest-wrap {
                  font-size: 13px;
                  color: #4E4E4E
                }

                  .TnITTtw-v-item {
                    display: inline-block
                  }

        .TnITTtw-listen-disabled {
          opacity: 0.475;
          cursor: default
        }

    .TnITTtw-right-particle {
      background: rgba(255, 255, 255, 0.125);
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;
      display: inline-block;
      width: 36px;
      height: 133px;
      vertical-align: top;
      box-shadow: inset 1px 0 3px rgba(43, 43, 43, 0.05), inset 0 1px 0 #F5F5F5
    }

      .TnITTtw-sidebar {

      }

        .TnITTtw-sbutton {
          position: absolute;
          -webkit-user-select: none;
          cursor: pointer
        }

        .TnITTtw-listen-button {
          width: 16px;
          height: 17px;
          background: url(chrome-extension://ihmgiclibbndffejedjimfjmfoabpcke/resources/images/sprites/sprite.png);
          background-position: -54px 153px;
          margin: 10px 0 0 10px
        }

          .TnITTtw-listen-button:active, .TnITTtw-listen-disabled {
            background-position: -54px 136px
          }

/* ========== */
/* Scrollbars */

#TnITTtw-trVisibleLayout {
  position: relative !important;
  overflow: hidden;
  height: 133px;
  width: 100%
}

#TnITTtw-tr-scrollbar {
  position: absolute;
  display: block;
  width: 9px; 
  height: 135px; 
  font-size: 1px
}

#TnITTtw-track { 
  position: absolute;
  left: 185px;
  top: -134px;
  width: 11px;
  height: 129px;
  background: transparent
}

#TnITTtw-dragBar {
  position: absolute; 
  left: 1px;
  top: 1px;
  width: 5px; 
  height: 10px;
  background: rgba(43, 43, 43, 0.475);
  cursor: pointer;
  border-radius: 3px;
  box-shadow: 0 1px 0 #FFF
}

  #TnITTtw-dragBar:hover, #TnITTtw-dragBar:active {
    background: rgba(43, 43, 43, 0.775)
  } 

#TnITTtw-scrollbar, #TnITTtw-track, #TnITTtw-dragBar {
  -webkit-user-select: none
}</style><style type="text/css">#TnITTtw-tooltip-wrap {
  position: absolute;
  z-index: 9999;
  font-family: Tahoma;
  font-size: 13px;
  line-height: normal
}

  .TnITTtw-inside-layout {

  }

    .TnITTtw-content {
      
    }</style><style type="text/css">#TnITTtw-tooltip-wrap {
  position: absolute;
  z-index: 9999;
  font-family: Tahoma;
  font-size: 13px;
  line-height: normal
}

  .TnITTtw-inside-layout {

  }

    .TnITTtw-content {
      
    }</style><style type="text/css">.TnITTtw-arrow {
  display: none;
  width: 12px;
  height: 6px;
  background: url(chrome-extension://ihmgiclibbndffejedjimfjmfoabpcke/resources/images/sprites/sprite.png);
  position: relative
}

.TnITTtw-top-arrow {
  background-position: -108px 148px;
  bottom: -1px
}

.TnITTtw-bottom-arrow {
  background-position: -108px 154px;
  top: -1px
}</style><style type="text/css"></style><style type="text/css"></style></head><body><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">/**<br>&nbsp;*&nbsp;This&nbsp;file&nbsp;copyright&nbsp;(C)&nbsp;2010&nbsp;Barry&nbsp;Hunter&nbsp;(sphinx@barryhunter.co.uk)<br>&nbsp;*<br>&nbsp;*&nbsp;This&nbsp;program&nbsp;is&nbsp;free&nbsp;software;&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or<br>&nbsp;*&nbsp;modify&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License<br>&nbsp;*&nbsp;as&nbsp;published&nbsp;by&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation;&nbsp;either&nbsp;version&nbsp;2<br>&nbsp;*&nbsp;of&nbsp;the&nbsp;License,&nbsp;or&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.<br>&nbsp;*<br>&nbsp;*&nbsp;This&nbsp;program&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,<br>&nbsp;*&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of<br>&nbsp;*&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the<br>&nbsp;*&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.<br>&nbsp;*<br>&nbsp;*&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License<br>&nbsp;*&nbsp;along&nbsp;with&nbsp;this&nbsp;program;&nbsp;if&nbsp;not,&nbsp;write&nbsp;to&nbsp;the&nbsp;Free&nbsp;Software<br>&nbsp;*&nbsp;Foundation,&nbsp;Inc.,&nbsp;59&nbsp;Temple&nbsp;Place&nbsp;-&nbsp;Suite&nbsp;330,&nbsp;Boston,&nbsp;MA&nbsp;&nbsp;02111-1307,&nbsp;USA.<br>&nbsp;*/<br><br>#&nbsp;Version&nbsp;0.1&nbsp;-&nbsp;First&nbsp;release&nbsp;(very&nbsp;basic&nbsp;and&nbsp;not&nbsp;fully&nbsp;functional)<br>#&nbsp;Version&nbsp;0.2&nbsp;-&nbsp;Made&nbsp;the&nbsp;Configuration&nbsp;section&nbsp;usuable<br>#&nbsp;Version&nbsp;0.3&nbsp;-&nbsp;(withdrawn&nbsp;-&nbsp;had&nbsp;broken&nbsp;implementation)<br>#&nbsp;Version&nbsp;0.4&nbsp;-&nbsp;Added&nbsp;support&nbsp;for&nbsp;highlighted&nbsp;excerpts/snippets&nbsp;body&nbsp;in&nbsp;the&nbsp;results<br>#&nbsp;Version&nbsp;0.5&nbsp;-&nbsp;support&nbsp;for&nbsp;paging!&nbsp;(and&nbsp;configuable&nbsp;page&nbsp;size)<br>#&nbsp;Version&nbsp;0.6&nbsp;-&nbsp;support&nbsp;for&nbsp;a&nbsp;single&nbsp;attribute&nbsp;-&nbsp;for&nbsp;facetted&nbsp;browsing!<br>#&nbsp;Version&nbsp;0.7&nbsp;-&nbsp;support&nbsp;for&nbsp;multiple&nbsp;attributes!<br><br>#&nbsp;See&nbsp;a&nbsp;running&nbsp;demo&nbsp;of&nbsp;THIS&nbsp;code:&nbsp;http://www.nearby.org.uk/sphinx/example7.php?q=test<br>#&nbsp;&nbsp;nothing&nbsp;changed,&nbsp;other&nbsp;than&nbsp;hooking&nbsp;it&nbsp;up&nbsp;with&nbsp;a&nbsp;sphinx&nbsp;index,&nbsp;and&nbsp;mysql&nbsp;database.&nbsp;<br><br>######################<br>#&nbsp;Change&nbsp;this&nbsp;settings&nbsp;to&nbsp;match&nbsp;your&nbsp;setup...<br><br></span><span style="color: #0000BB">$CONF&nbsp;</span><span style="color: #007700">=&nbsp;array();<br><br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_host'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_port'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">9312</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//this&nbsp;demo&nbsp;uses&nbsp;the&nbsp;SphinxAPI&nbsp;interface<br><br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_host'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_username'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_database'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"data"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_index'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"yourindex"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;can&nbsp;also&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;indexes,&nbsp;"main,&nbsp;delta"<br><br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]&nbsp;=&nbsp;array(</span><span style="color: #DD0000">"category"</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"string"</span><span style="color: #007700">,</span><span style="color: #DD0000">"year"</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"numeric"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;this&nbsp;defines&nbsp;attributes&nbsp;to&nbsp;use&nbsp;for&nbsp;breakdowns,&nbsp;each&nbsp;need&nbsp;defining&nbsp;as&nbsp;string/numeric<br><br>#can&nbsp;use&nbsp;'excerpt'&nbsp;to&nbsp;highlight&nbsp;using&nbsp;the&nbsp;query,&nbsp;or&nbsp;'asis'&nbsp;to&nbsp;show&nbsp;description&nbsp;as&nbsp;is.<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'body'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'excerpt'</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#the&nbsp;link&nbsp;for&nbsp;the&nbsp;title&nbsp;(only&nbsp;$id)&nbsp;placeholder&nbsp;supported<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'link_format'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'/page.php?page_id=$id'</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#Change&nbsp;this&nbsp;to&nbsp;FALSE&nbsp;on&nbsp;a&nbsp;live&nbsp;site!<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'debug'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#How&nbsp;many&nbsp;results&nbsp;per&nbsp;page&nbsp;(also&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;attributes&nbsp;shown)&nbsp;<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">25</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#maximum&nbsp;number&nbsp;of&nbsp;results&nbsp;-&nbsp;should&nbsp;match&nbsp;sphinxes&nbsp;max_matches.&nbsp;default&nbsp;1000<br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'max_matches'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">1000</span><span style="color: #007700">;<br><br><br></span><span style="color: #FF8000">######################<br>#mysql&nbsp;query&nbsp;to&nbsp;fetch&nbsp;results,&nbsp;needs&nbsp;`id`,&nbsp;`title`&nbsp;and&nbsp;`body`&nbsp;columns&nbsp;in&nbsp;the&nbsp;final&nbsp;result.<br>#$ids&nbsp;is&nbsp;replaced&nbsp;by&nbsp;the&nbsp;list&nbsp;of&nbsp;ids<br>#this&nbsp;query&nbsp;can&nbsp;be&nbsp;as&nbsp;arbitary&nbsp;complex&nbsp;as&nbsp;required&nbsp;-&nbsp;but&nbsp;mysql&nbsp;has&nbsp;be&nbsp;able&nbsp;to&nbsp;run&nbsp;it&nbsp;quickly<br>#DO&nbsp;NOT&nbsp;include&nbsp;a&nbsp;order&nbsp;by&nbsp;(but&nbsp;if&nbsp;use&nbsp;GROUP&nbsp;BY,&nbsp;put&nbsp;ORDER&nbsp;BY&nbsp;NULL)&nbsp;-&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;results&nbsp;doesnt&nbsp;matter<br>#TIP&nbsp;can&nbsp;also&nbsp;do&nbsp;::&nbsp;CONCAT(description,'&nbsp;Category:',category)&nbsp;AS&nbsp;body&nbsp;::&nbsp;for&nbsp;exmaple<br><br></span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_query'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'<br>SELECT&nbsp;page_id&nbsp;AS&nbsp;id,&nbsp;title&nbsp;AS&nbsp;title,&nbsp;description&nbsp;AS&nbsp;body<br>FROM&nbsp;your_table<br>WHERE&nbsp;page_id&nbsp;IN&nbsp;($ids)<br>'</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#might&nbsp;need&nbsp;to&nbsp;put&nbsp;in&nbsp;path&nbsp;to&nbsp;your&nbsp;file<br></span><span style="color: #007700">if&nbsp;(!empty(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'q'</span><span style="color: #007700">]))&nbsp;require(</span><span style="color: #DD0000">"sphinxapi.php"</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">######################<br>#&nbsp;change&nbsp;the&nbsp;look&nbsp;and&nbsp;feel<br><br></span><span style="color: #0000BB">?&gt;<br></span>&lt;style&nbsp;type="text/css"&gt;<br>form#search&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;background-color:silver:<br>&nbsp;&nbsp;&nbsp;&nbsp;padding:10px;<br>}<br>ul.sidebar&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;float:left;<br>&nbsp;&nbsp;&nbsp;&nbsp;width:120px;<br>&nbsp;&nbsp;&nbsp;&nbsp;margin-right:40px;<br>&nbsp;&nbsp;&nbsp;&nbsp;border-right:1px&nbsp;solid&nbsp;gray;<br>&nbsp;&nbsp;&nbsp;&nbsp;height:100%;<br>}<br>ul.results&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;border:1px&nbsp;solid&nbsp;silver;<br>}<br>.results&nbsp;li&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;font-size:0.9em;<br>}<br>.results&nbsp;li&nbsp;a&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;font-weight:bold;<br>&nbsp;&nbsp;&nbsp;&nbsp;font-size:1.2em;<br>}<br><br>.pages&nbsp;a&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;color:brown;<br>&nbsp;&nbsp;&nbsp;&nbsp;text-decoration:&nbsp;none;<br>&nbsp;&nbsp;&nbsp;&nbsp;padding:4px;<br>&nbsp;&nbsp;&nbsp;&nbsp;margin:2px;<br>&nbsp;&nbsp;&nbsp;&nbsp;border:1px&nbsp;solid&nbsp;silver;<br>&nbsp;&nbsp;&nbsp;&nbsp;background-color:#eeeeee;<br>}<br>.pages&nbsp;b&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;padding:4px;<br>&nbsp;&nbsp;&nbsp;&nbsp;margin:2px;<br>&nbsp;&nbsp;&nbsp;&nbsp;background-color:#eeeeee;<br>}<br><br>&lt;/style&gt;<br><span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">##################################################################<br>##################################################################<br>#<br>#&nbsp;Nothing&nbsp;below&nbsp;should&nbsp;need&nbsp;changing&nbsp;-&nbsp;should&nbsp;work&nbsp;as&nbsp;is<br>#&nbsp;&nbsp;but&nbsp;of&nbsp;course&nbsp;this&nbsp;is&nbsp;only&nbsp;a&nbsp;basic&nbsp;demo,&nbsp;can&nbsp;customise&nbsp;it&nbsp;to&nbsp;your&nbsp;needs<br>#<br><br><br><br>//Sanitise&nbsp;the&nbsp;input<br></span><span style="color: #0000BB">$q&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'q'</span><span style="color: #007700">])?</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'q'</span><span style="color: #007700">]:</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$q&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'/&nbsp;OR&nbsp;/'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&nbsp;|&nbsp;'</span><span style="color: #007700">,</span><span style="color: #0000BB">$q</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$q&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[^\w~\|\(\)"\/=-]+/'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&nbsp;'</span><span style="color: #007700">,</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$q</span><span style="color: #007700">)));<br><br></span><span style="color: #FF8000">//Display&nbsp;the&nbsp;HTML&nbsp;search&nbsp;form<br></span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action="?"&nbsp;method="get"&nbsp;id="search"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Search:&nbsp;&lt;input&nbsp;name="q"&nbsp;type="text"&nbsp;value="<span style="color: #0000BB">&lt;?&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$q</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">?&gt;</span>"/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="submit"&nbsp;value="Search"/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br><span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//If&nbsp;the&nbsp;user&nbsp;entered&nbsp;something<br></span><span style="color: #007700">if&nbsp;(!empty(</span><span style="color: #0000BB">$q</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//produce&nbsp;a&nbsp;version&nbsp;for&nbsp;display<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$qo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$q</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$qo</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">64</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$qo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'--complex&nbsp;query--'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//setup&nbsp;paging...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!empty(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'page'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">intval</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'page'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">)&nbsp;||&nbsp;</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$currentOffset&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)*&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$currentOffset&nbsp;</span><span style="color: #007700">&gt;&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'max_matches'</span><span style="color: #007700">]-</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">])&nbsp;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"Only&nbsp;the&nbsp;first&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'max_matches'</span><span style="color: #007700">]}</span><span style="color: #DD0000">&nbsp;results&nbsp;accessible"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$currentOffset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Connect&nbsp;to&nbsp;sphinx,&nbsp;and&nbsp;run&nbsp;the&nbsp;query<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SphinxClient</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetServer</span><span style="color: #007700">(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_host'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_port'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetSortMode</span><span style="color: #007700">(</span><span style="color: #0000BB">SPH_SORT_EXTENDED</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"@relevance&nbsp;DESC,&nbsp;@id&nbsp;DESC"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetMatchMode</span><span style="color: #007700">(</span><span style="color: #0000BB">SPH_MATCH_EXTENDED</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetLimits</span><span style="color: #007700">(</span><span style="color: #0000BB">$currentOffset</span><span style="color: #007700">,</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">]);&nbsp;</span><span style="color: #FF8000">//current&nbsp;page&nbsp;and&nbsp;number&nbsp;of&nbsp;results<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(empty(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//plain&nbsp;text&nbsp;search<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Query</span><span style="color: #007700">(</span><span style="color: #0000BB">$q</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_index'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$attr&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'string'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//string&nbsp;attributes&nbsp;must&nbsp;go&nbsp;in&nbsp;the&nbsp;fulltext&nbsp;query<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q2&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&nbsp;@</span><span style="color: #007700">{</span><span style="color: #0000BB">$attr</span><span style="color: #007700">}</span><span style="color: #DD0000">&nbsp;\"</span><span style="color: #007700">{</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr</span><span style="color: #007700">]}</span><span style="color: #DD0000">\""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFilter</span><span style="color: #007700">(</span><span style="color: #0000BB">$attr</span><span style="color: #007700">,array(</span><span style="color: #0000BB">intval</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">AddQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$q</span><span style="color: #007700">.</span><span style="color: #0000BB">$q2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_index'</span><span style="color: #007700">]);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetRankingMode</span><span style="color: #007700">(</span><span style="color: #0000BB">SPH_RANK_NONE</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//because&nbsp;we&nbsp;dont&nbsp;use&nbsp;the&nbsp;rank,&nbsp;may&nbsp;as&nbsp;well&nbsp;not&nbsp;calculate&nbsp;it!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetSortMode</span><span style="color: #007700">(</span><span style="color: #0000BB">SPH_SORT_EXTENDED</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"@id&nbsp;ASC"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//the&nbsp;natuarl&nbsp;order,&nbsp;so&nbsp;sphinx&nbsp;skips&nbsp;sorting&nbsp;step<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$attr&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ResetFilters</span><span style="color: #007700">();&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$attr2&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$type2</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$attr&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">)&nbsp;</span><span style="color: #FF8000">//we&nbsp;dont&nbsp;want&nbsp;to&nbsp;filter&nbsp;on&nbsp;the&nbsp;current&nbsp;attribute.&nbsp;Otherwise&nbsp;the&nbsp;breakdown&nbsp;would&nbsp;only&nbsp;show&nbsp;matching.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$type2&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'string'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//string&nbsp;attributes&nbsp;must&nbsp;go&nbsp;in&nbsp;the&nbsp;fulltext&nbsp;query<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q2&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&nbsp;@</span><span style="color: #007700">{</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">}</span><span style="color: #DD0000">&nbsp;\"</span><span style="color: #007700">{</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">]}</span><span style="color: #DD0000">\""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFilter</span><span style="color: #007700">(</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">,array(</span><span style="color: #0000BB">intval</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr2</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetSelect</span><span style="color: #007700">(</span><span style="color: #0000BB">$attr</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetGroupBy</span><span style="color: #007700">(</span><span style="color: #0000BB">$attr</span><span style="color: #007700">,</span><span style="color: #0000BB">SPH_GROUPBY_ATTR</span><span style="color: #007700">,</span><span style="color: #DD0000">'@count&nbsp;DESC'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">AddQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$q</span><span style="color: #007700">.</span><span style="color: #0000BB">$q2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_index'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$results&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">RunQueries</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$results</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Check&nbsp;for&nbsp;failure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(empty(</span><span style="color: #0000BB">$res</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"Query&nbsp;failed:&nbsp;--&nbsp;please&nbsp;try&nbsp;again&nbsp;later.\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'debug'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">GetLastError</span><span style="color: #007700">())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;Error:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">GetLastError</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//We&nbsp;have&nbsp;results&nbsp;to&nbsp;display!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'debug'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">GetLastWarning</span><span style="color: #007700">())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;WARNING:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">GetLastWarning</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query_info&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Query&nbsp;'"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$qo</span><span style="color: #007700">).</span><span style="color: #DD0000">"'&nbsp;retrieved&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'matches'</span><span style="color: #007700">]).</span><span style="color: #DD0000">"&nbsp;of&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #0000BB">total_found</span><span style="color: #007700">]</span><span style="color: #DD0000">&nbsp;matches&nbsp;in&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #0000BB">time</span><span style="color: #007700">]</span><span style="color: #DD0000">&nbsp;sec.\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$resultCount&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'total_found'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$numberOfPages&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ceil</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'total'</span><span style="color: #007700">]/</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">"matches"</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Build&nbsp;a&nbsp;list&nbsp;of&nbsp;IDs&nbsp;for&nbsp;use&nbsp;in&nbsp;the&nbsp;mysql&nbsp;Query&nbsp;and&nbsp;looping&nbsp;though&nbsp;the&nbsp;results<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ids&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">"matches"</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;pre&nbsp;class=\"results\"&gt;No&nbsp;Results&nbsp;for&nbsp;'"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$qo</span><span style="color: #007700">).</span><span style="color: #DD0000">"'&lt;/pre&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$counter&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_attributes'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$attr&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$results</span><span style="color: #007700">[</span><span style="color: #0000BB">$counter</span><span style="color: #007700">])&nbsp;||&nbsp;empty(</span><span style="color: #0000BB">$results</span><span style="color: #007700">[</span><span style="color: #0000BB">$counter</span><span style="color: #007700">][</span><span style="color: #DD0000">'matches'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$counter</span><span style="color: #007700">++;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;ul&nbsp;class='sidebar'&gt;&lt;b&gt;</span><span style="color: #0000BB">$attr</span><span style="color: #DD0000">&lt;/b&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$results</span><span style="color: #007700">[</span><span style="color: #0000BB">$counter</span><span style="color: #007700">][</span><span style="color: #DD0000">'matches'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$idx&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'attrs'</span><span style="color: #007700">][</span><span style="color: #0000BB">$attr</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//we&nbsp;dont&nbsp;use&nbsp;@groupby,&nbsp;because&nbsp;it&nbsp;wrong&nbsp;for&nbsp;string&nbsp;attributes.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #0000BB">$attr</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;b&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/b&gt;&nbsp;&lt;i&gt;(&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$attr</span><span style="color: #007700">)).</span><span style="color: #DD0000">"\"&gt;remove&lt;/a&gt;)&lt;/i&gt;&lt;/li&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$attr</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)).</span><span style="color: #DD0000">"\"&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/a&gt;&nbsp;(</span><span style="color: #007700">{</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'attrs'</span><span style="color: #007700">][</span><span style="color: #DD0000">'@count'</span><span style="color: #007700">]}</span><span style="color: #DD0000">)&lt;/li&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;/ul&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$counter</span><span style="color: #007700">++;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//We&nbsp;have&nbsp;results&nbsp;to&nbsp;display<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!empty(</span><span style="color: #0000BB">$ids</span><span style="color: #007700">))&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Setup&nbsp;Database&nbsp;Connection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_host'</span><span style="color: #007700">],</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_username'</span><span style="color: #007700">],</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">])&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"ERROR:&nbsp;unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;database"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_database'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">)&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"ERROR:&nbsp;unable&nbsp;to&nbsp;select&nbsp;database"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Run&nbsp;the&nbsp;Mysql&nbsp;Query<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'$ids'</span><span style="color: #007700">,</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">,</span><span style="color: #0000BB">$ids</span><span style="color: #007700">),</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql_query'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)&nbsp;or&nbsp;die(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'debug'</span><span style="color: #007700">]?(</span><span style="color: #DD0000">"ERROR:&nbsp;mysql&nbsp;query&nbsp;failed:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">()):</span><span style="color: #DD0000">"ERROR:&nbsp;Please&nbsp;try&nbsp;later"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">mysql_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Fetch&nbsp;Results&nbsp;from&nbsp;Mysql&nbsp;(Store&nbsp;in&nbsp;an&nbsp;accociative&nbsp;array,&nbsp;because&nbsp;they&nbsp;wont&nbsp;be&nbsp;in&nbsp;the&nbsp;right&nbsp;order)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;array();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">,</span><span style="color: #0000BB">MYSQL_ASSOC</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rows</span><span style="color: #007700">[</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Call&nbsp;Sphinxes&nbsp;BuildExcerpts&nbsp;function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'body'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'excerpt'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$docs&nbsp;</span><span style="color: #007700">=&nbsp;array();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$ids&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$docs</span><span style="color: #007700">[</span><span style="color: #0000BB">$c</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">strip_tags</span><span style="color: #007700">(</span><span style="color: #0000BB">$rows</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'body'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$reply&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$cl</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">BuildExcerpts</span><span style="color: #007700">(</span><span style="color: #0000BB">$docs</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'sphinx_index'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$q</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$numberOfPages&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;p&nbsp;class='pages'&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">pagesString</span><span style="color: #007700">(</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">,</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/p&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Actully&nbsp;display&nbsp;the&nbsp;Results<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">print&nbsp;</span><span style="color: #DD0000">"&lt;ol&nbsp;class=\"results\"&nbsp;start=\""</span><span style="color: #007700">.(</span><span style="color: #0000BB">$currentOffset</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">).</span><span style="color: #DD0000">"\"&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$ids&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rows</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'$id'</span><span style="color: #007700">,</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">],</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'link_format'</span><span style="color: #007700">]));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;a&nbsp;href=\"</span><span style="color: #0000BB">$link</span><span style="color: #DD0000">\"&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'title'</span><span style="color: #007700">]).</span><span style="color: #DD0000">"&lt;/a&gt;&lt;br/&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'body'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'excerpt'&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;!empty(</span><span style="color: #0000BB">$reply</span><span style="color: #007700">[</span><span style="color: #0000BB">$c</span><span style="color: #007700">]))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #0000BB">$reply</span><span style="color: #007700">[</span><span style="color: #0000BB">$c</span><span style="color: #007700">]).</span><span style="color: #DD0000">"&lt;/li&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'body'</span><span style="color: #007700">]).</span><span style="color: #DD0000">"&lt;/li&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;/ol&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$numberOfPages&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$resultCount&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'max_matches'</span><span style="color: #007700">])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Note:&nbsp;You&nbsp;have&nbsp;reached&nbsp;the&nbsp;last&nbsp;page&nbsp;of&nbsp;results,&nbsp;for&nbsp;performance&nbsp;reasons&nbsp;we<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;only&nbsp;allow&nbsp;access&nbsp;to&nbsp;the&nbsp;first&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'max_matches'</span><span style="color: #007700">]}</span><span style="color: #DD0000">.&nbsp;To&nbsp;browse&nbsp;more&nbsp;results&nbsp;please&nbsp;add<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;keywords&nbsp;to&nbsp;refine&nbsp;your&nbsp;search.&lt;/p&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$numberOfPages&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;p&nbsp;class='pages'&gt;Page&nbsp;</span><span style="color: #0000BB">$currentPage</span><span style="color: #DD0000">&nbsp;of&nbsp;</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #DD0000">.&nbsp;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Result&nbsp;%d..%d&nbsp;of&nbsp;%d.&nbsp;"</span><span style="color: #007700">,(</span><span style="color: #0000BB">$currentOffset</span><span style="color: #007700">)+</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">min</span><span style="color: #007700">((</span><span style="color: #0000BB">$currentOffset</span><span style="color: #007700">)+</span><span style="color: #0000BB">$CONF</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_size'</span><span style="color: #007700">],</span><span style="color: #0000BB">$resultCount</span><span style="color: #007700">),</span><span style="color: #0000BB">$resultCount</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">pagesString</span><span style="color: #007700">(</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">,</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/p&gt;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"&lt;pre&nbsp;class=\"results\"&gt;</span><span style="color: #0000BB">$query_info</span><span style="color: #DD0000">&lt;/pre&gt;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Error&nbsp;Message<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">print&nbsp;</span><span style="color: #DD0000">"&lt;pre&nbsp;class=\"results\"&gt;Unable&nbsp;to&nbsp;get&nbsp;results&nbsp;for&nbsp;'"</span><span style="color: #007700">.</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$qo</span><span style="color: #007700">).</span><span style="color: #DD0000">"'&lt;/pre&gt;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br><br><br></span><span style="color: #FF8000">#########################################<br>#&nbsp;Functions&nbsp;<br>#&nbsp;Created&nbsp;by&nbsp;Barry&nbsp;Hunter&nbsp;for&nbsp;use&nbsp;in&nbsp;the&nbsp;geograph.org.uk&nbsp;project,&nbsp;reused&nbsp;here&nbsp;because&nbsp;convenient&nbsp;:)<br><br></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">,</span><span style="color: #0000BB">$selflink</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;array();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">'?'</span><span style="color: #007700">,</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_URI'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$b</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]))&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">],</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'value'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'value'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'null'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'value'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$del</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$del</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">]]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$selflink</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$selflink&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'SCRIPT_NAME'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$selflink&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'/index.php'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$selflink&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/'</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$selflink</span><span style="color: #007700">.(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">)?(</span><span style="color: #DD0000">"?"</span><span style="color: #007700">.</span><span style="color: #0000BB">http_build_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #DD0000">'&amp;'</span><span style="color: #007700">)):</span><span style="color: #DD0000">''</span><span style="color: #007700">));<br>}<br><br><br>function&nbsp;</span><span style="color: #0000BB">pagesString</span><span style="color: #007700">(</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">,</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #007700">,</span><span style="color: #0000BB">$postfix&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #0000BB">$extrahtml&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">''</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;</span><span style="color: #0000BB">$r</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$r</span><span style="color: #007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(</span><span style="color: #0000BB">$r</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$currentPage&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'page'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)).</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$postfix</span><span style="color: #DD0000">\"</span><span style="color: #0000BB">$extrahtml</span><span style="color: #DD0000">&gt;&amp;lt;&nbsp;&amp;lt;&nbsp;prev&lt;/a&gt;&nbsp;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">max</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">-</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$endr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">min</span><span style="color: #007700">(</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">+</span><span style="color: #0000BB">8</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$start&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'page'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">)).</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$postfix</span><span style="color: #DD0000">\"</span><span style="color: #0000BB">$extrahtml</span><span style="color: #DD0000">&gt;1&lt;/a&gt;&nbsp;...&nbsp;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;for(</span><span style="color: #0000BB">$index&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$start</span><span style="color: #007700">;</span><span style="color: #0000BB">$index</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$endr</span><span style="color: #007700">;</span><span style="color: #0000BB">$index</span><span style="color: #007700">++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$index&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;</span><span style="color: #0000BB">$index</span><span style="color: #DD0000">&lt;/b&gt;&nbsp;"</span><span style="color: #007700">;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'page'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$index</span><span style="color: #007700">)).</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$postfix</span><span style="color: #DD0000">\"</span><span style="color: #0000BB">$extrahtml</span><span style="color: #DD0000">&gt;</span><span style="color: #0000BB">$index</span><span style="color: #DD0000">&lt;/a&gt;&nbsp;"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$endr&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$numberOfPages</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"...&nbsp;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$numberOfPages&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\""</span><span style="color: #007700">.</span><span style="color: #0000BB">linktoself</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'page'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$currentPage</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">)).</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$postfix</span><span style="color: #DD0000">\"</span><span style="color: #0000BB">$extrahtml</span><span style="color: #DD0000">&gt;next&nbsp;&amp;gt;&amp;gt;&lt;/a&gt;&nbsp;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$r</span><span style="color: #007700">;<br>}<br></span>
</span>
</code></body></html>